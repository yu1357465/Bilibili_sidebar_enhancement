这是一份为您准备的**代码结构导读（目录）**。

首先回答您的问题：这也是 **JavaScript (JS)** 语言。具体来说，这是一种运行在浏览器插件（如 Tampermonkey 油猴）上的脚本，通常被称为 **UserScript（用户脚本）**。

您可以把这份代码想象成一个**“双核处理程序”**，它根据你访问的页面不同，启动两套不同的逻辑。

---

### 📖 代码全书目录：Bilibili 侧栏美化脚本

#### **第一章：脚本身份证 (Metadata)**

- **位置：** 顶部的 `// ==UserScript==` 到 `// ==/UserScript==`
- **作用：** 告诉浏览器插件这个脚本叫什么、版本号是多少、在哪些网址生效（`@match`）、以及需要什么样的权限（`@grant`）。

#### **第二章：安全容器 (IIFE Wrapper)**

- **位置：** `(function () {` ... `})();`
- **作用：** 这是一个巨大的括号，把所有代码包裹在里面。作用是建立一个“独立沙盒”，防止代码里的变量名字和 B 站网页原有的代码冲突。

#### **第三章：全局设定 (Global Settings)**

- **位置：** 脚本开头部分
- **内容：**

1. **页面判断：** 定义了 `IS_NEW_PAGE` 和 `IS_OLD_PAGE`，用来识别当前是新版还是旧版页面。
2. **图标库 (`ICONS`)：** 存储了所有的 SVG 图标代码（如全屏图标、锁图标、魔法棒等），相当于一个素材仓库。

#### **第四章：新版页面引擎 (New Page Logic)**

- **函数名：** `function runNewPageLogic()`
- **作用：** 专门处理 B 站新版（Opus）页面的逻辑。
- **内部结构：**
- **CSS 定义 (`cssNew`)：** 定义新版页面的样式。
- **功能函数：** 包括移动目录按钮、智能缩放 (`performSmartZoom`)、沉浸模式切换、侧栏交互等。
- **初始化 (`injectElements`)：** 负责在新版页面上创建和插入按钮。

#### **第五章：旧版页面引擎 (Old Page Logic)**

- **函数名：** `function runOldPageLogic()`
- **作用：** 专门处理 B 站旧版（Read/CV）页面的逻辑。
- **内部结构：**
- **CSS 定义 (`cssOld`)：** 这里的 CSS 最长，因为它需要把旧版原本散乱的图标强制改成“白底胶囊”风格，并隐藏原生通知。
- **注入函数 (`injectButtons`)：** 负责在旧版页面插入“新版入口”、“回到顶部”、“锁定”等按钮。

#### **第六章：通用工具箱 (Common Utilities)**

- **位置：** 两个主逻辑函数下方
- **作用：** 服务于所有页面的公共功能。

1. **弹窗通知 (`showToast`)：** 咱们自己写的、漂亮的屏幕中央白底弹窗。
2. **点击监听 (`initGlobalClickObserver`)：** 负责检测鼠标点击空白处时，自动收起侧边栏或目录。
3. **目录增强 (`forceCloseCatalog`, `initCatalogEnhancer`)：** 修复目录面板的点击和关闭逻辑。

#### **第七章：拦截器 (The Interceptor)**

- **函数名：** `initInterceptor()`
- **作用：** 这是一个“监控探头”。它时刻监视网页变化，一旦发现 B 站原生的“土味通知”想弹出来，就立刻拦截它，并调用我们的漂亮弹窗显示内容。

#### **第八章：程序入口 (Main Entry)**

- **位置：** 代码的最末尾
- **作用：** 整个脚本的指挥官。

1. 启动拦截器。
2. 如果是新版页面 -> 启动**第四章**的引擎。
3. 如果是旧版页面 -> 启动**第五章**的引擎。

---

**学习建议：**
现在您可以从代码里复制任意一段（比如复制 `ICONS` 变量，或者 `runOldPageLogic` 里的某几行 CSS），发给我，我来为您详细讲解这一小块代码具体在做什么。
